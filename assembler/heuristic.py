import cfunc_caller
import ctypes
import array
import helpers

var_code = b'\x41\x83\xf8\x01\x0f\x84\xb6\x03\x00\x00\x0f\x8e\x40\x03\x00\x00\x41\x83\xf8\x02\x0f\x84\xa6\x01\x00\x00\x41\x83\xf8\x03\x0f\x85\xec\x03\x00\x00\x41\x57\x41\x56\x31\xc0\x41\x55\x41\x54\x49\x89\xfe\x55\x53\x40\x0f\xbe\xde\x41\xbf\xff\xff\xff\xff\x89\x5c\x24\xf8\x89\x44\x24\xfc\x48\x89\x7c\x24\xf0\x66\x0f\x1f\x44\x00\x00\x41\x8d\x4f\x01\x45\x8d\x57\x02\x31\xc0\x8d\x14\xcd\x00\x00\x00\x00\x8d\x72\x06\x44\x8d\x42\x0e\x8d\x7a\x0f\x8d\x6a\xf7\x8d\x5a\xf8\x44\x8d\x5a\xf9\x48\x63\xf6\x4d\x63\xc0\x48\x63\xff\x44\x8d\x62\xff\x48\x89\x74\x24\xe8\xeb\x15\x0f\x1f\x80\x00\x00\x00\x00\x48\x83\xc0\x01\x48\x83\xf8\x08\x0f\x84\x02\x01\x00\x00\x41\x80\x3c\x06\x00\x75\xeb\x48\x83\xf8\x07\x41\x89\xc1\x0f\x84\x5e\x01\x00\x00\x85\xc0\x0f\x84\xf6\x01\x00\x00\x41\x83\xff\x07\x77\x4a\x44\x8d\x6c\x05\x00\x48\x8b\x74\x24\xf0\x4d\x63\xed\x46\x0f\xb6\x2c\x2e\x44\x3b\x6c\x24\xf8\x0f\x84\xaf\x00\x00\x00\x44\x8d\x2c\x03\x4d\x63\xed\x46\x0f\xb6\x2c\x2e\x44\x39\x6c\x24\xf8\x0f\x84\x98\x00\x00\x00\x45\x01\xd9\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x39\x4c\x24\xf8\x0f\x84\x82\x00\x00\x00\x83\xf9\x07\x77\x2e\x45\x8d\x0c\x04\x4c\x8b\x6c\x24\xf0\x8b\x74\x24\xf8\x4d\x63\xc9\x47\x0f\xb6\x4c\x0d\x00\x41\x39\xf1\x74\x62\x44\x8d\x4c\x02\x01\x4d\x63\xc9\x47\x0f\xb6\x4c\x0d\x00\x44\x39\xce\x74\x4f\x41\x83\xfa\x07\x0f\x87\x49\xff\xff\xff\x44\x8d\x6c\x02\x07\x48\x8b\x74\x24\xf0\x4d\x63\xed\x46\x0f\xb6\x2c\x2e\x44\x3b\x6c\x24\xf8\x74\x2c\x44\x8d\x6c\x02\x08\x4d\x63\xed\x46\x0f\xb6\x2c\x2e\x44\x39\x6c\x24\xf8\x74\x18\x44\x8d\x4c\x10\x09\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x39\x4c\x24\xf8\x0f\x85\x04\xff\xff\xff\x48\x83\xc0\x01\x83\x44\x24\xfc\x01\x48\x83\xf8\x08\x0f\x85\xff\xfe\xff\xff\x90\x49\x83\xc6\x08\x83\xf9\x07\x41\x89\xcf\x0f\x85\xa0\xfe\xff\xff\x8b\x44\x24\xfc\x5b\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3\x90\x45\x31\xc9\x40\x80\xfe\x01\x44\x0f\xbe\xc6\x41\x0f\x94\xc1\x31\xc9\x31\xc0\x41\x83\xc1\x01\xeb\x1c\x0f\x1f\x80\x00\x00\x00\x00\x44\x39\xce\x75\x06\x0f\xbe\x34\x0a\x29\xf0\x48\x83\xc1\x01\x48\x83\xf9\x40\x74\x19\x0f\xb6\x34\x0f\x44\x39\xc6\x75\xe2\x0f\xbe\x34\x0a\x48\x83\xc1\x01\x01\xf0\x48\x83\xf9\x40\x75\xe7\xf3\xc3\x41\x83\xff\x07\x77\x3a\x44\x8d\x6c\x05\x00\x48\x8b\x74\x24\xf0\x4d\x63\xed\x46\x0f\xb6\x2c\x2e\x44\x3b\x6c\x24\xf8\x0f\x84\x59\xff\xff\xff\x41\x01\xd9\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x39\x4c\x24\xf8\x0f\x84\x43\xff\xff\xff\x0f\x1f\x80\x00\x00\x00\x00\x83\xf9\x07\x0f\x87\x57\x01\x00\x00\x48\x8b\x74\x24\xf0\x4c\x8b\x4c\x24\xe8\x46\x0f\xb6\x0c\x0e\x44\x3b\x4c\x24\xf8\x0f\x84\x19\xff\xff\xff\x41\x83\xfa\x07\x0f\x87\x13\xfe\xff\xff\x0f\x1f\x00\x48\x8b\x74\x24\xf0\x44\x8b\x6c\x24\xf8\x46\x0f\xb6\x0c\x06\x45\x39\xe9\x0f\x84\xf4\xfe\xff\xff\x44\x0f\xb6\x0c\x3e\x45\x39\xcd\x0f\x85\xfa\xfe\xff\xff\xe9\xe1\xfe\xff\xff\x0f\x1f\x44\x00\x00\x41\x83\xff\x07\x77\x32\x44\x8d\x2c\x03\x48\x8b\x74\x24\xf0\x4d\x63\xed\x46\x0f\xb6\x2c\x2e\x44\x3b\x6c\x24\xf8\x0f\x84\xba\xfe\xff\xff\x45\x01\xd9\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x3b\x4c\x24\xf8\x0f\x84\xa4\xfe\xff\xff\x83\xf9\x07\x77\x1d\x44\x8d\x4c\x02\x01\x48\x8b\x74\x24\xf0\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x3b\x4c\x24\xf8\x0f\x84\x82\xfe\xff\xff\x41\x83\xfa\x07\x0f\x87\x7c\xfd\xff\xff\x44\x8d\x4c\x02\x08\x48\x8b\x74\x24\xf0\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x39\x4c\x24\xf8\x0f\x84\x5b\xfe\xff\xff\x44\x8d\x4c\x02\x09\x4d\x63\xc9\x46\x0f\xb6\x0c\x0e\x44\x39\x4c\x24\xf8\x0f\x85\x47\xfd\xff\xff\xe9\x3e\xfe\xff\xff\x66\x90\x45\x85\xc0\x0f\x85\xb7\x00\x00\x00\x45\x31\xd2\x40\x80\xfe\x01\x44\x0f\xbe\xce\x41\x0f\x94\xc2\x31\xc0\x41\x83\xc2\x01\xeb\x16\x44\x39\xd6\x75\x07\x0f\xbe\x34\x02\x41\x29\xf0\x48\x83\xc0\x01\x48\x83\xf8\x40\x74\x1a\x0f\xb6\x34\x07\x41\x39\xf1\x75\xe1\x0f\xbe\x34\x02\x48\x83\xc0\x01\x41\x01\xf0\x48\x83\xf8\x40\x75\xe6\x43\x8d\x04\x80\x01\xc8\x01\xc0\xc3\x0f\x1f\x80\x00\x00\x00\x00\x41\x83\xfa\x07\x0f\x86\xc6\xfe\xff\xff\xe9\xd1\xfc\xff\xff\x90\x45\x31\xc0\x40\x80\xfe\x01\x40\x0f\xbe\xce\x41\x0f\x94\xc0\x48\x8d\x77\x40\x31\xc0\x41\x83\xc0\x01\xeb\x19\x0f\x1f\x44\x00\x00\x41\x39\xd0\x0f\x94\xc2\x48\x83\xc7\x01\x0f\xb6\xd2\x29\xd0\x48\x39\xf7\x74\x13\x0f\xb6\x17\x39\xca\x75\xe5\x48\x83\xc7\x01\x83\xc0\x01\x48\x39\xf7\x75\xed\xf3\xc3\x0f\x1f\x80\x00\x00\x00\x00\xb8\xb2\x9e\x43\xff\xc3'

code = var_code

func = cfunc_caller.generate_function(code, ctypes.c_int, ctypes.c_char_p, ctypes.c_char, ctypes.c_char_p, ctypes.c_int,
                                      ctypes.c_int)

board = helpers.from_tournament_format(
    list('???????????........??........??........??...o@...??...@o...??........??........??........???????????'))
board = helpers.from_tournament_format(
    list('???????????@@@@@oo@??@@@@@@@@??@@o@o@@@??@@@o@@o@??o@@@@@o@??o@@@ooo@??o@@@@oo@??..@@@@@@???????????'))
SQUARE_WEIGHTS = [120, -20, 20, 5, 5, 20, -20, 120, -20, -40, -5, -5, -5, -5, -40, -20, 20, -5, 15, 3, 3, 15, -5, 20, 5,
                  -5, 3, 3, 3, 3, -5, 5, 5, -5, 3, 3, 3, 3, -5, 5, 20, -5, 15, 3, 3, 15, -5, 20, -20, -40, -5, -5, -5,
                  -5, -40, -20, 120, -20, 20, 5, 5, 20, -20, 120]
buf = array.array('b', SQUARE_WEIGHTS)


def array_pointer(arr):
    return ctypes.cast(arr.buffer_info()[0], ctypes.c_char_p)


print("Function result: " + str(func(array_pointer(board), 1, array_pointer(buf), 5, 3)))
print("Arr: " + str(board))
print("Buf: " + str(buf))
print("Legal moves: " + str(helpers.legal_moves(board, 1)))
