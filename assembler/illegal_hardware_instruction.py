import cfunc_caller
import ctypes
import array
import helpers

var_code = b'\x41\x57\x41\x56\x40\x0f\xbe\xc6\x41\x55\x41\x54\x48\x89\xf9\x55\x53\x41\xbf\xff\xff\xff\xff\x48\x89\x7c\x24\xd8\x89\x74\x24\xf4\xc7\x44\x24\xf0\x00\x00\x00\x89\x44\x24\xec\x48\x89\x7c\x24\xf8\x0f\x1f\x80\x00\x00\x00\x00\x41\x8d\x77\x01\x45\x8d\x5f\x02\x31\xc0\x8d\x14\xf5\x00\x00\x00\x00\x8d\x7a\x06\x44\x8d\x4a\x0e\x44\x8d\x42\x0f\x44\x8d\x62\xf7\x8d\x6a\xf8\x8d\x5a\xf9\x48\x63\xff\x4d\x63\xc9\x4d\x63\xc0\x44\x8d\x6a\xff\x48\x89\x7c\x24\xe0\xeb\x14\x66\x0f\x1f\x44\x00\x00\x48\x83\xc0\x01\x48\x83\xf8\x08\x0f\x84\x02\x01\x00\x00\x80\x3c\x01\x00\x75\xec\x48\x83\xf8\x07\x41\x89\xc2\x0f\x84\xff\x02\x00\x00\x85\xc0\x0f\x84\x07\x04\x00\x00\x41\x83\xff\x07\x77\x4a\x45\x8d\x34\x04\x48\x8b\x7c\x24\xd8\x4d\x63\xf6\x46\x0f\xb6\x34\x37\x44\x3b\x74\x24\xec\x0f\x84\xaf\x00\x00\x00\x44\x8d\x74\x05\x00\x4d\x63\xf6\x46\x0f\xb6\x34\x37\x44\x39\x74\x24\xec\x0f\x84\x97\x00\x00\x00\x41\x01\xda\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x39\x54\x24\xec\x0f\x84\x81\x00\x00\x00\x83\xfe\x07\x77\x2d\x45\x8d\x54\x05\x00\x4c\x8b\x74\x24\xd8\x8b\x7c\x24\xec\x4d\x63\xd2\x47\x0f\xb6\x14\x16\x41\x39\xfa\x74\x61\x44\x8d\x54\x02\x01\x4d\x63\xd2\x47\x0f\xb6\x14\x16\x44\x39\xd7\x74\x4f\x41\x83\xfb\x07\x0f\x87\x4b\xff\xff\xff\x44\x8d\x74\x02\x07\x48\x8b\x7c\x24\xd8\x4d\x63\xf6\x46\x0f\xb6\x34\x37\x44\x3b\x74\x24\xec\x74\x2c\x44\x8d\x74\x02\x08\x4d\x63\xf6\x46\x0f\xb6\x34\x37\x44\x39\x74\x24\xec\x74\x18\x44\x8d\x54\x10\x09\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x39\x54\x24\xec\x0f\x85\x06\xff\xff\xff\x48\x83\xc0\x01\x83\x6c\x24\xf0\x01\x48\x83\xf8\x08\x0f\x85\x01\xff\xff\xff\x0f\x1f\x00\x48\x83\xc1\x08\x83\xfe\x07\x41\x89\xf7\x0f\x85\xa0\xfe\xff\xff\x31\xc0\x80\x7c\x24\xf4\x01\x48\x8b\x54\x24\xf8\xbe\xff\xff\xff\xff\x0f\x94\xc0\x83\xc0\x01\x89\x44\x24\xec\x0f\x1f\x44\x00\x00\x8d\x7e\x01\x8d\x5e\x02\x31\xc0\x8d\x0c\xfd\x00\x00\x00\x00\x44\x8d\x41\x06\x44\x8d\x51\x0e\x44\x8d\x49\x0f\x44\x8d\x69\xf7\x44\x8d\x61\xf8\x8d\x69\xf9\x4d\x63\xc0\x4d\x63\xd2\x4d\x63\xc9\x44\x8d\x71\xff\x4c\x89\x44\x24\xe0\xeb\x14\x66\x0f\x1f\x44\x00\x00\x48\x83\xc0\x01\x48\x83\xf8\x08\x0f\x84\x02\x01\x00\x00\x80\x3c\x02\x00\x75\xec\x48\x83\xf8\x07\x41\x89\xc3\x0f\x84\x17\x01\x00\x00\x85\xc0\x0f\x84\xe7\x01\x00\x00\x83\xfe\x07\x77\x4a\x45\x8d\x7c\x05\x00\x4c\x8b\x44\x24\xd8\x4d\x63\xff\x47\x0f\xb6\x3c\x38\x44\x39\x7c\x24\xec\x0f\x84\xad\x00\x00\x00\x45\x8d\x3c\x04\x4d\x63\xff\x47\x0f\xb6\x3c\x38\x44\x39\x7c\x24\xec\x0f\x84\x96\x00\x00\x00\x41\x01\xeb\x4d\x63\xdb\x47\x0f\xb6\x1c\x18\x44\x39\x5c\x24\xec\x0f\x84\x80\x00\x00\x00\x83\xff\x07\x77\x2d\x45\x8d\x1c\x06\x4c\x8b\x7c\x24\xd8\x44\x8b\x44\x24\xec\x4d\x63\xdb\x47\x0f\xb6\x1c\x1f\x45\x39\xd8\x74\x60\x44\x8d\x5c\x01\x01\x4d\x63\xdb\x47\x0f\xb6\x1c\x1f\x45\x39\xd8\x74\x4e\x83\xfb\x07\x0f\x87\x4d\xff\xff\xff\x44\x8d\x7c\x01\x07\x4c\x8b\x44\x24\xd8\x4d\x63\xff\x47\x0f\xb6\x3c\x38\x44\x3b\x7c\x24\xec\x74\x2c\x44\x8d\x7c\x01\x08\x4d\x63\xff\x47\x0f\xb6\x3c\x38\x44\x3b\x7c\x24\xec\x74\x18\x44\x8d\x5c\x08\x09\x4d\x63\xdb\x47\x0f\xb6\x1c\x18\x44\x3b\x5c\x24\xec\x0f\x85\x08\xff\xff\xff\x48\x83\xc0\x01\x83\x44\x24\xf0\x01\x48\x83\xf8\x08\x0f\x85\x03\xff\xff\xff\x0f\x1f\x44\x00\x00\x48\x83\xc2\x08\x83\xff\x07\x89\xfe\x0f\x85\xa1\xfe\xff\xff\x8b\x44\x24\xf0\x5b\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x83\xfe\x07\x77\x2b\x45\x8d\x7c\x05\x00\x4c\x8b\x44\x24\xd8\x4d\x63\xff\x47\x0f\xb6\x3c\x38\x44\x39\x7c\x24\xec\x74\xa2\x45\x01\xe3\x4d\x63\xdb\x47\x0f\xb6\x1c\x18\x44\x39\x5c\x24\xec\x74\x90\x83\xff\x07\x0f\x87\x2f\x02\x00\x00\x4c\x8b\x5c\x24\xd8\x4c\x8b\x7c\x24\xe0\x47\x0f\xb6\x1c\x3b\x44\x39\x5c\x24\xec\x0f\x84\x6d\xff\xff\xff\x83\xfb\x07\x0f\x87\x6c\xfe\xff\xff\xe9\x10\x02\x00\x00\x0f\x1f\x80\x00\x00\x00\x00\x41\x83\xff\x07\x77\x32\x45\x8d\x34\x04\x48\x8b\x7c\x24\xd8\x4d\x63\xf6\x46\x0f\xb6\x34\x37\x44\x3b\x74\x24\xec\x0f\x84\xb8\xfd\xff\xff\x41\x01\xea\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x39\x54\x24\xec\x0f\x84\xa2\xfd\xff\xff\x83\xfe\x07\x0f\x87\x77\x01\x00\x00\x48\x8b\x7c\x24\xd8\x4c\x8b\x74\x24\xe0\x46\x0f\xb6\x14\x37\x44\x3b\x54\x24\xec\x0f\x84\x7f\xfd\xff\xff\x41\x83\xfb\x07\x0f\x87\x7b\xfc\xff\xff\xe9\x58\x01\x00\x00\x66\x0f\x1f\x44\x00\x00\x83\xfe\x07\x77\x32\x45\x8d\x3c\x04\x4c\x8b\x44\x24\xd8\x4d\x63\xff\x47\x0f\xb6\x3c\x38\x44\x39\x7c\x24\xec\x0f\x84\xc7\xfe\xff\xff\x41\x01\xeb\x4d\x63\xdb\x47\x0f\xb6\x1c\x18\x44\x39\x5c\x24\xec\x0f\x84\xb1\xfe\xff\xff\x83\xff\x07\x77\x1d\x44\x8d\x5c\x01\x01\x4c\x8b\x7c\x24\xd8\x4d\x63\xdb\x47\x0f\xb6\x1c\x1f\x44\x39\x5c\x24\xec\x0f\x84\x8f\xfe\xff\xff\x83\xfb\x07\x0f\x87\x8e\xfd\xff\xff\x44\x8d\x5c\x01\x08\x4c\x8b\x7c\x24\xd8\x4d\x63\xdb\x47\x0f\xb6\x1c\x1f\x44\x3b\x5c\x24\xec\x0f\x84\x69\xfe\xff\xff\x44\x8d\x5c\x01\x09\x4d\x63\xdb\x47\x0f\xb6\x1c\x1f\x44\x3b\x5c\x24\xec\x0f\x85\x59\xfd\xff\xff\xe9\x4c\xfe\xff\xff\x0f\x1f\x40\x00\x41\x83\xff\x07\x77\x33\x44\x8d\x74\x05\x00\x48\x8b\x7c\x24\xd8\x4d\x63\xf6\x46\x0f\xb6\x34\x37\x44\x3b\x74\x24\xec\x0f\x84\xa7\xfc\xff\xff\x41\x01\xda\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x3b\x54\x24\xec\x0f\x84\x91\xfc\xff\xff\x83\xfe\x07\x77\x1d\x44\x8d\x54\x02\x01\x48\x8b\x7c\x24\xd8\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x3b\x54\x24\xec\x0f\x84\x6f\xfc\xff\xff\x41\x83\xfb\x07\x0f\x87\x6b\xfb\xff\xff\x44\x8d\x54\x02\x08\x48\x8b\x7c\x24\xd8\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x3b\x54\x24\xec\x0f\x84\x48\xfc\xff\xff\x44\x8d\x54\x02\x09\x4d\x63\xd2\x46\x0f\xb6\x14\x17\x44\x3b\x54\x24\xec\x0f\x85\x36\xfb\xff\xff\xe9\x2b\xfc\xff\xff\x66\x0f\x1f\x84\x00\x00\x00\x41\x83\xfb\x07\x0f\x87\x1e\xfb\xff\xff\x48\x8b\x7c\x24\xd8\x44\x8b\x74\x24\xec\x46\x0f\xb6\x14\x0f\x45\x39\xf2\x0f\x84\x00\xfc\xff\xff\x46\x0f\xb6\x14\x07\x45\x39\xd6\x0f\x84\xf2\xfb\xff\xff\x48\x83\xc1\x08\x83\xfe\x07\x41\x89\xf7\x0f\x85\xa8\xfa\xff\xff\xe9\x03\xfc\xff\xff\x0f\x1f\x00\x83\xfb\x07\x0f\x87\x57\xfc\xff\xff\x4c\x8b\x7c\x24\xd8\x44\x8b\x44\x24\xec\x47\x0f\xb6\x1c\x17\x45\x39\xd8\x0f\x84\x37\xfd\xff\xff\x47\x0f\xb6\x1c\x0f\x45\x39\xd8\x0f\x84\x29\xfd\xff\xff\x48\x83\xc2\x08\x83\xff\x07\x89\xfe\x0f\x85\xe2\xfb\xff\xff\xe9\x3c\xfd\xff\xff'

code = var_code

func = cfunc_caller.generate_function(code, ctypes.c_int, ctypes.c_char_p, ctypes.c_char)

board = helpers.from_tournament_format(list('???????????........??........??........??...o@...??...@o...??........??........??........???????????'))
board = helpers.from_tournament_format(list('???????????@@@@@oo@??@@@@@@@@??@@o@o@@@??@@@o@@o@??o@@@@@o@??o@@@ooo@??o@@@@oo@??..@@@@@@???????????'))
SQUARE_WEIGHTS = [    120, -20, 20, 5, 5, 20, -20, 120,    -20, -40, -5, -5, -5, -5, -40, -20,    20, -5, 15, 3, 3, 15, -5, 20,    5, -5, 3, 3, 3, 3, -5, 5,    5, -5, 3, 3, 3, 3, -5, 5,    20, -5, 15, 3, 3, 15, -5, 20,    -20, -40, -5, -5, -5, -5, -40, -20,    120, -20, 20, 5, 5, 20, -20, 120]
buf = array.array('b', SQUARE_WEIGHTS)

def array_pointer(arr):
    return ctypes.cast(arr.buffer_info()[0], ctypes.c_char_p)

print("Function result: " + str(func(array_pointer(board), 1)))
print("Arr: " + str(board))
print("Buf: " + str(buf))
print("Legal moves: " + str(helpers.legal_moves(board, 1)))
