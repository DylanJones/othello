import cfunc_caller
import ctypes
import array
import helpers

# with char - doesn't work
#code = b'\x41\x57\x40\x80\xfe\x01\x41\x56\x41\x55\x41\x54\x41\x0f\x94\xc4\x55\x53\x41\x83\xc4\x01\x45\x31\xf6\x45\x31\xff\x48\x89\x54\x24\xf0\x40\x88\x74\x24\xfe\xeb\x16\x0f\x1f\x84\x00\x00\x00\x00\x49\x83\xc6\x01\x49\x83\xfe\x40\x0f\x84\xeb\x00\x00\x00\x42\x80\x3c\x37\x00\x75\xeb\x44\x89\xf0\x44\x89\xf3\xbd\xff\xff\xff\xff\xc1\xf8\x03\x83\xe3\x07\x88\x44\x24\xff\x83\xe8\x02\x88\x5c\x24\xfc\x88\x44\x24\xfd\x0f\xb6\x44\x24\xff\x80\x7c\x24\xfd\x06\x41\x89\xea\x41\xbb\xff\xff\xff\xff\x8d\x1c\x28\x41\x0f\x96\xc5\x0f\xb6\x44\x24\xfc\x45\x89\xd9\x44\x00\xd8\x79\x70\x45\x84\xed\x74\x6b\x89\xda\x0f\xbe\xcb\xb8\xff\xff\xff\xff\x0f\x1f\x44\x00\x00\x0f\xbe\xf0\x8d\x0c\xce\x48\x63\xc9\x44\x38\x24\x0f\x75\x4d\x44\x01\xd2\x44\x01\xc8\x8d\x72\xff\x0f\xbe\xca\x40\x80\xfe\x06\x89\xc6\x41\x0f\x96\xc0\x40\xc0\xee\x07\x41\x84\xf0\x75\xd2\x80\xfa\x07\x77\x29\x3c\x07\x77\x25\x0f\xbe\xd2\x0f\xbe\xc0\x8d\x04\xd0\x0f\xb6\x54\x24\xfe\x48\x98\x3a\x14\x07\x75\x10\x48\x8b\x54\x24\xf0\x49\x63\xc7\x41\x83\xc7\x01\x44\x88\x34\x02\x41\x83\xc3\x01\x41\x83\xfb\x02\x0f\x85\x75\xff\xff\xff\x83\xc5\x01\x80\x44\x24\xfd\x01\x83\xfd\x02\x0f\x85\x4a\xff\xff\xff\x49\x83\xc6\x01\x49\x83\xfe\x40\x0f\x85\x15\xff\xff\xff\x5b\x44\x89\xf8\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3'

# with uchar - segfaults
#code = b'\x41\x57\x41\x56\x40\x0f\xbe\xc6\x41\x55\x41\x54\x49\x89\xfe\x55\x53\x45\x31\xed\x31\xdb\x48\x83\xec\x18\x48\x89\x54\x24\x08\x89\x44\x24\x04\xeb\x0d\x0f\x1f\x00\x48\x83\xc3\x01\x48\x83\xfb\x40\x74\x6b\x41\x80\x3c\x1e\x00\x41\x89\xdc\x75\xec\x41\x89\xdf\x41\x83\xe4\x07\xbd\xff\xff\xff\xff\x41\xc1\xff\x03\x44\x89\x24\x24\x41\xbc\xff\xff\xff\xff\x8b\x0c\x24\x8b\x74\x24\x04\x45\x89\xe1\x41\x89\xe8\x44\x89\xfa\x4c\x89\xf7\xe8\x00\x00\x00\x00\x84\xc0\x74\x0f\x48\x8b\x4c\x24\x08\x49\x63\xc5\x41\x83\xc5\x01\x88\x1c\x01\x41\x83\xc4\x01\x41\x83\xfc\x02\x75\xcb\x83\xc5\x01\x83\xfd\x02\x75\xbd\x48\x83\xc3\x01\x48\x83\xfb\x40\x75\x95\x48\x83\xc4\x18\x44\x89\xe8\x5b\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3'
# uchar with -O0
code = b'\x55\x48\x89\xe5\x48\x83\xec\x40\x48\x89\x7d\xd8\x89\xf0\x48\x89\x55\xc8\x88\x45\xd4\xc7\x45\xe8\x00\x00\x00\x00\xc7\x45\xec\x00\x00\x00\x00\x83\x7d\xec\x3f\x0f\x8f\xae\x00\x00\x00\x8b\x45\xec\x8d\x50\x07\x85\xc0\x0f\x48\xc2\xc1\xf8\x03\x89\x45\xf8\x8b\x45\xec\x99\xc1\xea\x1d\x01\xd0\x83\xe0\x07\x29\xd0\x89\x45\xfc\x8b\x45\xec\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x84\xc0\x75\x6f\xc7\x45\xf0\xff\xff\xff\xff\x83\x7d\xf0\x01\x7f\x62\xc7\x45\xf4\xff\xff\xff\xff\x83\x7d\xf4\x01\x7f\x4f\x8b\x45\xf4\x44\x0f\xbe\xc0\x8b\x45\xf0\x0f\xbe\xf8\x8b\x45\xfc\x0f\xbe\xc8\x8b\x45\xf8\x0f\xbe\xd0\x0f\xbe\x75\xd4\x48\x8b\x45\xd8\x45\x89\xc1\x41\x89\xf8\x48\x89\xc7\xe8\x00\x00\x00\x00\x84\xc0\x74\x16\x8b\x45\xe8\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x8b\x55\xec\x88\x10\x83\x45\xe8\x01\x83\x45\xf4\x01\xeb\xab\x83\x45\xf0\x01\xeb\x98\x83\x45\xec\x01\xe9\x48\xff\xff\xff\x8b\x45\xe8\xc9\xc3'
# after fixing the types
code = b'\x55\x48\x89\xe5\x48\x83\xec\x40\x48\x89\x7d\xd8\x89\xf0\x48\x89\x55\xc8\x88\x45\xd4\xc7\x45\xe8\x00\x00\x00\x00\xc7\x45\xec\x00\x00\x00\x00\x83\x7d\xec\x3f\x0f\x8f\xae\x00\x00\x00\x8b\x45\xec\x8d\x50\x07\x85\xc0\x0f\x48\xc2\xc1\xf8\x03\x89\x45\xf8\x8b\x45\xec\x99\xc1\xea\x1d\x01\xd0\x83\xe0\x07\x29\xd0\x89\x45\xfc\x8b\x45\xec\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x84\xc0\x75\x6f\xc7\x45\xf0\xff\xff\xff\xff\x83\x7d\xf0\x01\x7f\x62\xc7\x45\xf4\xff\xff\xff\xff\x83\x7d\xf4\x01\x7f\x4f\x8b\x45\xf4\x44\x0f\xbe\xc0\x8b\x45\xf0\x0f\xbe\xf8\x8b\x45\xfc\x0f\xbe\xc8\x8b\x45\xf8\x0f\xbe\xd0\x0f\xbe\x75\xd4\x48\x8b\x45\xd8\x45\x89\xc1\x41\x89\xf8\x48\x89\xc7\xe8\x00\x00\x00\x00\x84\xc0\x74\x16\x8b\x45\xe8\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x8b\x55\xec\x88\x10\x83\x45\xe8\x01\x83\x45\xf4\x01\xeb\xab\x83\x45\xf0\x01\xeb\x98\x83\x45\xec\x01\xe9\x48\xff\xff\xff\x8b\x45\xe8\xc9\xc3\x55\x48\x89\xe5\x89\xf8\x88\x45\xfc\x80\x7d\xfc\x01\x75\x07\xb8\x02\x00\x00\x00\xeb\x05\xb8\x01\x00\x00\x00\x5d\xc3\x55\x48\x89\xe5\x53\x48\x83\xec\x38\x48\x89\x7d\xd8\x89\xc8\x44\x89\xcf\x89\xf1\x88\x4d\xd4\x88\x55\xd0\x88\x45\xcc\x44\x89\xc0\x88\x45\xc8\x89\xf8\x88\x45\xc4\x0f\xb6\x55\xd0\x0f\xb6\x45\xc8\x01\xd0\x88\x45\xd0\x0f\xb6\x55\xcc\x0f\xb6\x45\xc4\x01\xd0\x88\x45\xcc\xc6\x45\xef\x00\x80\x7d\xd0\x00\x7e\x4c\x80\x7d\xd0\x07\x7f\x46\x80\x7d\xcc\x00\x7e\x40\x80\x7d\xcc\x07\x7f\x3a\x0f\xbe\x45\xd0\x8d\x14\xc5\x00\x00\x00\x00\x0f\xbe\x45\xcc\x01\xd0\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xd8\x0f\xbe\x45\xd4\x89\xc7\xe8\x00\x00\x00\x00\x0f\xbe\xc0\x39\xc3\x75\x07\xb8\x01\x00\x00\x00\xeb\x05\xb8\x00\x00\x00\x00\x84\xc0\x74\x20\xc6\x45\xef\x01\x0f\xb6\x55\xd0\x0f\xb6\x45\xc8\x01\xd0\x88\x45\xd0\x0f\xb6\x55\xcc\x0f\xb6\x45\xc4\x01\xd0\x88\x45\xcc\xeb\x85\x80\x7d\xd0\x00\x78\x1d\x80\x7d\xd0\x07\x7f\x17\x80\x7d\xcc\x00\x78\x11\x80\x7d\xcc\x07\x7f\x0b\x0f\xb6\x45\xef\x83\xf0\x01\x84\xc0\x74\x07\xb8\x00\x00\x00\x00\xeb\x2a\x0f\xbe\x45\xd0\x8d\x14\xc5\x00\x00\x00\x00\x0f\xbe\x45\xcc\x01\xd0\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xd0\x0f\xbe\x45\xd4\x39\xc2\x0f\x94\xc0\x48\x83\xc4\x38\x5b\x5d\xc3'
# again with -O3
code = b'\x40\x80\xfe\x01\x41\x57\x41\x56\x0f\x94\xc0\x41\x55\x41\x54\x83\xc0\x01\x55\x53\x44\x0f\xbe\xf8\x40\x0f\xbe\xc6\x49\x89\xfc\x48\x89\x54\x24\xf0\x45\x31\xf6\xc7\x44\x24\xe4\x00\x00\x00\x89\x44\x24\xfc\xeb\x11\x0f\x1f\x00\x49\x83\xc6\x01\x49\x83\xfe\x40\x0f\x84\x29\x01\x00\x00\x43\x80\x3c\x34\x00\x75\xeb\x45\x89\xf5\x45\x89\xf3\xbd\xff\xff\xff\xff\x41\x83\xe5\x07\x41\xc1\xfb\x03\x4c\x89\x74\x24\xe8\x41\x8d\x45\xff\x44\x88\x5c\x24\xfb\x41\x83\xeb\x02\x44\x89\xdb\x88\x44\x24\xfa\x0f\xb6\x44\x24\xfb\x41\x89\xea\x41\xb8\xff\xff\xff\xff\x44\x8d\x34\x28\x80\xfb\x06\x43\x8d\x44\x05\x00\x0f\x87\x07\x01\x00\x00\x0f\xb6\x7c\x24\xfa\x45\x31\xc9\x44\x89\xde\x41\x0f\xbe\xce\x42\x8d\x14\x07\x80\xfa\x06\x76\x38\xe9\xf9\x00\x00\x00\x66\x2e\x0f\x1f\x84\x00\x00\x8d\x56\xff\x44\x01\xc0\x40\x0f\xbe\xce\x80\xfa\x06\x0f\x87\xad\x00\x00\x00\x8d\x50\xff\x42\x8d\x34\x11\x41\xb9\x01\x00\x00\x00\x80\xfa\x06\x0f\x87\xaf\x00\x00\x00\x0f\xbe\xd1\x0f\xbe\xf8\x8d\x14\xd7\x48\x63\xd2\x41\x0f\xb6\x14\x14\x44\x39\xfa\x74\xc1\x41\x83\xf1\x01\x3c\x07\x7f\x34\x45\x84\xc9\x75\x2f\x0f\xbe\xc0\x8d\x04\xc8\x48\x98\x41\x0f\xb6\x04\x04\x3b\x44\x24\xfc\x75\x1c\x48\x63\x44\x24\xe4\x0f\xb6\x4c\x24\xe8\x48\x8b\x74\x24\xf0\x48\x89\xc7\x88\x0c\x06\x83\xc7\x01\x89\x7c\x24\xe4\x41\x83\xc0\x01\x41\x80\xf8\x02\x0f\x85\x42\xff\xff\xff\x83\xc5\x01\x41\x83\xc3\x02\x83\xc3\x01\x83\xfd\x02\x0f\x85\x1d\xff\xff\xff\x4c\x8b\x74\x24\xe8\x49\x83\xc6\x01\x49\x83\xfe\x40\x0f\x85\xd7\xfe\xff\xff\x0f\xb6\x44\x24\xe4\x5b\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3\x90\x45\x31\xc9\x40\x80\xfe\x07\x77\xb2\x84\xc0\x78\xae\xe9\x71\xff\xff\xff\x66\x0f\x1f\x44\x00\x00\x45\x31\xc9\xe9\x63\xff\xff\xff\x44\x89\xf6\x41\x0f\xbe\xce\x41\xb9\x01\x00\x00\x00\xeb\xd4\x44\x89\xf6\x41\xb9\x01\x00\x00\x00\xeb\xc9'
# removing the c directives from the assembly 
code = b'\x40\x80\xfe\x01\x41\x57\x41\x56\x0f\x94\xc0\x41\x55\x41\x54\x83\xc0\x01\x55\x53\x44\x0f\xbe\xf8\x40\x0f\xbe\xc6\x49\x89\xfc\x48\x89\x54\x24\xf0\x45\x31\xf6\xc7\x44\x24\xe4\x00\x00\x00\x89\x44\x24\xfc\xeb\x0e\x49\x83\xc6\x01\x49\x83\xfe\x40\x0f\x84\x1f\x01\x00\x00\x43\x80\x3c\x34\x00\x75\xeb\x45\x89\xf5\x45\x89\xf3\xbd\xff\xff\xff\xff\x41\x83\xe5\x07\x41\xc1\xfb\x03\x4c\x89\x74\x24\xe8\x41\x8d\x45\xff\x44\x88\x5c\x24\xfb\x41\x83\xeb\x02\x44\x89\xdb\x88\x44\x24\xfa\x0f\xb6\x44\x24\xfb\x41\x89\xea\x41\xb8\xff\xff\xff\xff\x44\x8d\x34\x28\x80\xfb\x06\x43\x8d\x44\x05\x00\x0f\x87\xf6\x00\x00\x00\x0f\xb6\x7c\x24\xfa\x45\x31\xc9\x44\x89\xde\x41\x0f\xbe\xce\x42\x8d\x14\x07\x80\xfa\x06\x76\x2e\xe9\xe8\x00\x00\x00\x8d\x56\xff\x44\x01\xc0\x40\x0f\xbe\xce\x80\xfa\x06\x0f\x87\xac\x00\x00\x00\x8d\x50\xff\x42\x8d\x34\x11\x41\xb9\x01\x00\x00\x00\x80\xfa\x06\x0f\x87\xa8\x00\x00\x00\x0f\xbe\xd1\x0f\xbe\xf8\x8d\x14\xd7\x48\x63\xd2\x41\x0f\xb6\x14\x14\x44\x39\xfa\x74\xc1\x41\x83\xf1\x01\x3c\x07\x7f\x34\x45\x84\xc9\x75\x2f\x0f\xbe\xc0\x8d\x04\xc8\x48\x98\x41\x0f\xb6\x04\x04\x3b\x44\x24\xfc\x75\x1c\x48\x63\x44\x24\xe4\x0f\xb6\x4c\x24\xe8\x48\x8b\x74\x24\xf0\x48\x89\xc7\x88\x0c\x06\x83\xc7\x01\x89\x7c\x24\xe4\x41\x83\xc0\x01\x41\x80\xf8\x02\x0f\x85\x4c\xff\xff\xff\x83\xc5\x01\x41\x83\xc3\x02\x83\xc3\x01\x83\xfd\x02\x0f\x85\x27\xff\xff\xff\x4c\x8b\x74\x24\xe8\x49\x83\xc6\x01\x49\x83\xfe\x40\x0f\x85\xe1\xfe\xff\xff\x0f\xb6\x44\x24\xe4\x5b\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3\x45\x31\xc9\x40\x80\xfe\x07\x77\xb3\x84\xc0\x78\xaf\xe9\x72\xff\xff\xff\x45\x31\xc9\xe9\x6a\xff\xff\xff\x44\x89\xf6\x41\x0f\xbe\xce\x41\xb9\x01\x00\x00\x00\xeb\xda\x44\x89\xf6\x41\xb9\x01\x00\x00\x00\xeb\xcf'
# don't acutally set values in the array
code = b'\x40\x80\xfe\x01\x41\x57\x41\x56\x0f\x94\xc0\x41\x55\x41\x54\x83\xc0\x01\x55\x53\x44\x0f\xbe\xe8\x40\x0f\xbe\xc6\x49\x89\xff\x48\xc7\x44\x24\xe8\x00\x00\x89\x44\x24\xfc\xc7\x44\x24\xf8\x00\x00\x00\x48\x8b\x44\x24\xe8\xeb\x1a\x0f\x1f\x44\x00\x00\x48\x83\x44\x24\xe8\x01\x48\x8b\x44\x24\xe8\x48\x83\xf8\x40\x0f\x84\x32\x01\x00\x00\x41\x80\x3c\x07\x00\x75\xe4\x48\x89\xc3\xc1\xf8\x03\x41\xbc\xff\xff\xff\xff\x88\x44\x24\xf7\x41\x89\xde\x83\xe8\x02\x41\x83\xe6\x07\x88\x44\x24\xf5\x88\x44\x24\xf4\x0f\xb6\x44\x24\xf7\x41\x8d\x6e\xff\x45\x89\xe3\xbb\xff\xff\xff\xff\x44\x01\xe0\x88\x44\x24\xf6\x80\x7c\x24\xf4\x06\x41\x89\xda\x41\x8d\x14\x1e\x0f\x87\xd0\x00\x00\x00\x8d\x45\xff\x3c\x06\x0f\x87\xc5\x00\x00\x00\x0f\xb6\x74\x24\xf5\x89\xef\x0f\xbe\x4c\x24\xf6\x45\x31\xc9\xeb\x2d\x0f\x1f\x40\x00\x8d\x46\xff\x44\x01\xd7\x40\x0f\xbe\xce\x89\xfa\x3c\x06\x0f\x87\x84\x00\x00\x00\x8d\x42\xff\x42\x8d\x34\x19\x41\xb9\x01\x00\x00\x00\x3c\x06\x0f\x87\x7f\x00\x00\x00\x0f\xbe\xc1\x44\x0f\xbe\xc2\x41\x8d\x04\xc0\x48\x98\x41\x0f\xb6\x04\x07\x44\x39\xe8\x74\xc0\x41\x83\xf1\x01\x80\xfa\x07\x7f\x20\x45\x84\xc9\x75\x1b\x0f\xbe\xd2\x8d\x04\xca\x48\x98\x41\x0f\xb6\x04\x07\x3b\x44\x24\xfc\x0f\x94\xc0\x0f\xb6\xc0\x01\x44\x24\xf8\x83\xc3\x01\x83\xc5\x01\x83\xfb\x02\x0f\x85\x56\xff\xff\xff\x41\x83\xc4\x01\x80\x44\x24\xf5\x02\x80\x44\x24\xf4\x01\x41\x83\xfc\x02\x0f\x85\x26\xff\xff\xff\xe9\xe3\xfe\xff\xff\x0f\x1f\x00\x45\x31\xc9\x40\x80\xfe\x07\x77\xc8\x84\xd2\x78\xc4\xeb\x9d\x90\x45\x31\xc9\xeb\x97\x0f\x1f\x00\x0f\xbe\x4c\x24\xf6\x41\xb9\x01\x00\x00\x00\x89\xce\xeb\xdc\x0f\xb6\x44\x24\xf8\x5b\x5d\x41\x5c\x41\x5d\x41\x5e\x41\x5f\xc3'

var_code = b'\x55\x48\x89\xe5\x48\x83\xec\x40\x48\x89\x7d\xd8\x89\xf0\x48\x89\x55\xc8\x88\x45\xd4\xc7\x45\xe8\x00\x00\x00\x00\xc7\x45\xec\x00\x00\x00\x00\x83\x7d\xec\x3f\x0f\x8f\x3a\x01\x00\x00\x8b\x45\xec\x8d\x50\x07\x85\xc0\x0f\x48\xc2\xc1\xf8\x03\x89\x45\xf8\x8b\x45\xec\x99\xc1\xea\x1d\x01\xd0\x83\xe0\x07\x29\xd0\x89\x45\xfc\x8b\x45\xec\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x84\xc0\x0f\x85\xf7\x00\x00\x00\xc7\x45\xf0\xff\xff\xff\xff\x83\x7d\xf0\x01\x0f\x8f\xe6\x00\x00\x00\xc7\x45\xf4\xff\xff\xff\xff\x83\x7d\xf4\x01\x0f\x8f\xcc\x00\x00\x00\x83\x7d\xf0\x00\x75\x0a\x83\x7d\xf4\x00\x0f\x84\xb2\x00\x00\x00\x8b\x45\xf4\x44\x0f\xbe\xc0\x8b\x45\xf0\x0f\xbe\xf8\x8b\x45\xfc\x0f\xbe\xc8\x8b\x45\xf8\x0f\xbe\xd0\x0f\xbe\x75\xd4\x48\x8b\x45\xd8\x45\x89\xc1\x41\x89\xf8\x48\x89\xc7\xe8\x00\x00\x00\x00\x85\xc0\x74\x2e\x83\x7d\xe8\x00\x74\x1b\x8b\x45\xe8\x48\x98\x48\x8d\x50\xff\x48\x8b\x45\xc8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xc0\x39\x45\xec\x74\x0d\x83\x7d\xe8\x3f\x7f\x07\xb8\x01\x00\x00\x00\xeb\x05\xb8\x00\x00\x00\x00\x84\xc0\x74\x49\x8b\x45\xf4\x44\x0f\xbe\xc0\x8b\x45\xf0\x0f\xbe\xf8\x8b\x45\xfc\x0f\xbe\xc8\x8b\x45\xf8\x0f\xbe\xd0\x0f\xbe\x75\xd4\x48\x8b\x45\xd8\x45\x89\xc1\x41\x89\xf8\x48\x89\xc7\xe8\x00\x00\x00\x00\x89\xc1\x8b\x45\xe8\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x89\xca\x88\x10\x83\x45\xe8\x01\xeb\x01\x90\x83\x45\xf4\x01\xe9\x2a\xff\xff\xff\x83\x45\xf0\x01\xe9\x10\xff\xff\xff\x83\x45\xec\x01\xe9\xbc\xfe\xff\xff\x8b\x45\xe8\xc9\xc3\x55\x48\x89\xe5\x89\xf8\x88\x45\xfc\x80\x7d\xfc\x01\x75\x07\xb8\x02\x00\x00\x00\xeb\x05\xb8\x01\x00\x00\x00\x5d\xc3\x55\x48\x89\xe5\x53\x48\x83\xec\x38\x48\x89\x7d\xd8\x89\xc8\x44\x89\xcf\x89\xf1\x88\x4d\xd4\x88\x55\xd0\x88\x45\xcc\x44\x89\xc0\x88\x45\xc8\x89\xf8\x88\x45\xc4\x0f\xb6\x55\xd0\x0f\xb6\x45\xc8\x01\xd0\x88\x45\xd0\x0f\xb6\x55\xcc\x0f\xb6\x45\xc4\x01\xd0\x88\x45\xcc\xc6\x45\xef\x00\x80\x7d\xd0\x00\x78\x4c\x80\x7d\xd0\x07\x7f\x46\x80\x7d\xcc\x00\x78\x40\x80\x7d\xcc\x07\x7f\x3a\x0f\xbe\x45\xd0\x8d\x14\xc5\x00\x00\x00\x00\x0f\xbe\x45\xcc\x01\xd0\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xd8\x0f\xbe\x45\xd4\x89\xc7\xe8\x00\x00\x00\x00\x0f\xbe\xc0\x39\xc3\x75\x07\xb8\x01\x00\x00\x00\xeb\x05\xb8\x00\x00\x00\x00\x84\xc0\x74\x20\xc6\x45\xef\x01\x0f\xb6\x55\xd0\x0f\xb6\x45\xc8\x01\xd0\x88\x45\xd0\x0f\xb6\x55\xcc\x0f\xb6\x45\xc4\x01\xd0\x88\x45\xcc\xeb\x85\x80\x7d\xd0\x00\x78\x1d\x80\x7d\xd0\x07\x7f\x17\x80\x7d\xcc\x00\x78\x11\x80\x7d\xcc\x07\x7f\x0b\x0f\xb6\x45\xef\x83\xf0\x01\x84\xc0\x74\x07\xb8\x00\x00\x00\x00\xeb\x36\x0f\xbe\x45\xd0\x8d\x14\xc5\x00\x00\x00\x00\x0f\xbe\x45\xcc\x01\xd0\x48\x63\xd0\x48\x8b\x45\xd8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xd0\x0f\xbe\x45\xd4\x39\xc2\x75\x07\xb8\x01\x00\x00\x00\xeb\x05\xb8\x00\x00\x00\x00\x90\x48\x83\xc4\x38\x5b\x5d\xc3'

code = var_code

func = cfunc_caller.generate_function(code, ctypes.c_char, ctypes.c_char_p, ctypes.c_char, ctypes.c_char_p)

board = helpers.from_tournament_format(list('???????????........??........??........??...o@...??...@o...??........??........??........???????????'))
board = helpers.from_tournament_format(list('???????????@@@@@oo@??@@@@@@@@??@@o@o@@@??@@@o@@o@??o@@@@@o@??o@@@ooo@??o@@@@oo@??..@@@@@@???????????'))
buf = array.array('B', [0]*64)

def array_pointer(arr):
    return ctypes.cast(arr.buffer_info()[0], ctypes.c_char_p)

print("Function result: " + str(func(array_pointer(board), 1, array_pointer(buf))))
print("Arr: " + str(board))
print("Buf: " + str(buf))
print("Legal moves: " + str(helpers.legal_moves(board, 1)))
