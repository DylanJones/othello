import cfunc_caller
import ctypes
import array
import helpers

var_code = b'\x55\x48\x89\xe5\x48\x89\x7d\xc8\x89\xf0\x88\x45\xc4\xc7\x45\xd4\x00\x00\x00\x00\xc7\x45\xd8\x00\x00\x00\x00\x83\x7d\xd8\x07\x0f\x8f\xf8\x00\x00\x00\xc7\x45\xdc\x00\x00\x00\x00\x83\x7d\xdc\x07\x0f\x8f\xde\x00\x00\x00\x8b\x45\xd8\x8d\x14\xc5\x00\x00\x00\x00\x8b\x45\xdc\x01\xd0\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x0f\xb6\x00\x84\xc0\x0f\x85\xb1\x00\x00\x00\xc7\x45\xe0\xff\xff\xff\xff\x83\x7d\xe0\x01\x0f\x8f\x9e\x00\x00\x00\xc7\x45\xe4\xff\xff\xff\xff\x83\x7d\xe4\x01\x0f\x8f\x84\x00\x00\x00\x8b\x55\xd8\x8b\x45\xe0\x01\xd0\x85\xc0\x78\x6f\x8b\x55\xd8\x8b\x45\xe0\x01\xd0\x83\xf8\x07\x7f\x62\x8b\x55\xdc\x8b\x45\xe4\x01\xd0\x85\xc0\x78\x56\x8b\x55\xdc\x8b\x45\xe4\x01\xd0\x83\xf8\x07\x7f\x49\x83\x7d\xe0\x00\x75\x06\x83\x7d\xe4\x00\x74\x3d\x8b\x55\xd8\x8b\x45\xe0\x01\xd0\x8d\x14\xc5\x00\x00\x00\x00\x8b\x45\xdc\x01\xc2\x8b\x45\xe4\x01\xd0\x89\x45\xf8\x8b\x45\xf8\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xd0\x0f\xbe\x45\xc4\x39\xc2\x75\x06\x83\x6d\xd4\x01\xeb\x13\x83\x45\xe4\x01\xe9\x72\xff\xff\xff\x83\x45\xe0\x01\xe9\x58\xff\xff\xff\x90\x90\x83\x45\xdc\x01\xe9\x18\xff\xff\xff\x83\x45\xd8\x01\xe9\xfe\xfe\xff\xff\x80\x7d\xc4\x01\x75\x07\xb8\x02\x00\x00\x00\xeb\x05\xb8\x01\x00\x00\x00\x88\x45\xc4\xc7\x45\xe8\x00\x00\x00\x00\x83\x7d\xe8\x07\x0f\x8f\xf8\x00\x00\x00\xc7\x45\xec\x00\x00\x00\x00\x83\x7d\xec\x07\x0f\x8f\xde\x00\x00\x00\x8b\x45\xe8\x8d\x14\xc5\x00\x00\x00\x00\x8b\x45\xec\x01\xd0\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x0f\xb6\x00\x84\xc0\x0f\x85\xb1\x00\x00\x00\xc7\x45\xf0\xff\xff\xff\xff\x83\x7d\xf0\x01\x0f\x8f\x9e\x00\x00\x00\xc7\x45\xf4\xff\xff\xff\xff\x83\x7d\xf4\x01\x0f\x8f\x84\x00\x00\x00\x8b\x55\xe8\x8b\x45\xf0\x01\xd0\x85\xc0\x78\x6f\x8b\x55\xe8\x8b\x45\xf0\x01\xd0\x83\xf8\x07\x7f\x62\x8b\x55\xec\x8b\x45\xf4\x01\xd0\x85\xc0\x78\x56\x8b\x55\xec\x8b\x45\xf4\x01\xd0\x83\xf8\x07\x7f\x49\x83\x7d\xf0\x00\x75\x06\x83\x7d\xf4\x00\x74\x3d\x8b\x55\xe8\x8b\x45\xf0\x01\xd0\x8d\x14\xc5\x00\x00\x00\x00\x8b\x45\xec\x01\xc2\x8b\x45\xf4\x01\xd0\x89\x45\xfc\x8b\x45\xfc\x48\x63\xd0\x48\x8b\x45\xc8\x48\x01\xd0\x0f\xb6\x00\x0f\xb6\xd0\x0f\xbe\x45\xc4\x39\xc2\x75\x06\x83\x45\xd4\x01\xeb\x13\x83\x45\xf4\x01\xe9\x72\xff\xff\xff\x83\x45\xf0\x01\xe9\x58\xff\xff\xff\x90\x90\x83\x45\xec\x01\xe9\x18\xff\xff\xff\x83\x45\xe8\x01\xe9\xfe\xfe\xff\xff\x8b\x45\xd4\x5d\xc3'

code = var_code

func = cfunc_caller.generate_function(code, ctypes.c_int, ctypes.c_char_p, ctypes.c_char)

board = helpers.from_tournament_format(list('???????????........??........??........??...o@...??...@o...??........??........??........???????????'))
board = helpers.from_tournament_format(list('???????????@@@@@oo@??@@@@@@@@??@@o@o@@@??@@@o@@o@??o@@@@@o@??o@@@ooo@??o@@@@oo@??..@@@@@@???????????'))
SQUARE_WEIGHTS = [    120, -20, 20, 5, 5, 20, -20, 120,    -20, -40, -5, -5, -5, -5, -40, -20,    20, -5, 15, 3, 3, 15, -5, 20,    5, -5, 3, 3, 3, 3, -5, 5,    5, -5, 3, 3, 3, 3, -5, 5,    20, -5, 15, 3, 3, 15, -5, 20,    -20, -40, -5, -5, -5, -5, -40, -20,    120, -20, 20, 5, 5, 20, -20, 120]
buf = array.array('b', SQUARE_WEIGHTS)

def array_pointer(arr):
    return ctypes.cast(arr.buffer_info()[0], ctypes.c_char_p)

print("Function result: " + str(func(array_pointer(board), 1)))
print("Arr: " + str(board))
print("Buf: " + str(buf))
print("Legal moves: " + str(helpers.legal_moves(board, 1)))
